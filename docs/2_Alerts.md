# Setup TradingView alerts

- Create a [TradingView](https://www.tradingview.com/) account
  - Go to a chart
  - Add an alert
- Configure alert
  - Setup your condition
  - Webhook url : `http://YOUR.STATIC.IP.ADDRESS/trades`
  - Search the exchange symbol alias format you want to trade (examples: XXX-PERP for FTX futures, XXX/USD for FTX spot, XXX/USDT for Binance USD markets ... you can use list markets command in [Commands section](./3_Commands.md)) 
  - Message should have this structure :
    - Long position :

        ```json
        { "stub": "dev", "direction": "long", "symbol": "ETH-PERP", "size": "50" }
        ```

    - Short position :

        ```json
        { "stub": "dev", "direction": "short", "symbol": "ETH-PERP", "size": "50" }
        ```

    - Close 100% of a position :

        ```json
        { "stub": "dev", "direction": "close", "symbol": "ETH-PERP" }
        ```

    - Close a fraction of a position in percent (⚠️ WATCH OUT, the fraction must be greater or equal than the minimum tradable amount set by the exchange for selected pair ! Size must be between 1 and 100 with a percent sign, otherwise 100% will be closed) :

        ```json
        { "stub": "dev", "direction": "close", "symbol": "ETH-PERP", "size": "50%" }
        ```

    - Open a long position with 5% of available collateral (Futures) or available balance (Spot) (⚠️ WATCH OUT, the fraction must be greater or equal than the minimum tradable amount set by the exchange for selected pair !) :

        ```json
        { "stub": "dev", "direction": "long", "symbol": "ETH-PERP", "size": "5%" }
        ```

    - Open a short position with 5% of available collateral (Futures) or available balance (Spot) (⚠️ WATCH OUT, the fraction must be greater or equal than the minimum tradable amount set by the exchange for selected pair !) :

        ```json
        { "stub": "dev", "direction": "short", "symbol": "ETH-PERP", "size": "5%" }
        ```

    - Long position with a 500 $US max budget :

        ```json
        { "stub": "dev", "direction": "long", "symbol": "ETH-PERP", "size": "50", "max": "500" }
        ```

    - Short position with a 500 $US max budget :

        ```json
        { "stub": "dev", "direction": "short", "symbol": "ETH-PERP", "size": "50", "max": "500" }
        ```

    - Process multiple trades :

        ```json
        [{ "stub": "dev", "direction": "long", "symbol": "ETH-PERP", "size": "50" }, { "stub": "dev", "direction": "long", "symbol": "BTC-PERP", "size": "50" }]
        ```

<!-- 
    - Short position and close opened Long position if any :

        ```json
        { "stub": "dev", "direction": "short", "symbol": "ETH-PERP", "size": "50", "mode": "reverse" }
        ```

    - Long position and close opened Short position if any :

        ```json
        { "stub": "dev", "direction": "long", "symbol": "ETH-PERP", "size": "50", "mode": "reverse" }
        ```
        
    - Close Long position if Short size is greater than opened position :

        ```json
        { "stub": "dev", "direction": "short", "symbol": "ETH-PERP", "size": "50", "mode": "overflow" }
        ```

    - Close Short position if Long size is greater than opened position :

        ```json
        { "stub": "dev", "direction": "long", "symbol": "ETH-PERP", "size": "50", "mode": "overflow" }
        ``` -->

## Duplicate alert guard
In some cases TradingView will repeatedly send the same signal. These duplicates can be filtered out by including the following additional parameters in the message sent to the webhook URL. The `TCycles` and `TBuys` parameters are values available in the Jackrabbit DCA module made available to subscribers of the [Jackrabbit Discord server](https://discord.gg/mNMVWXpAGd).

* `unique_chart` : the unique chart identifier (can be used to identify the chart). The sample below just uses the unique part of the (fictional) chart url `https://www.tradingview.com/chart/T3WBq7Nf/`.
* `TCycles` : the number of buy/sell cycles the algorithm has already completed
* `TBuys` : the number of buy signals generated by algorithm within the current cycle

The following is an example of a message with the duplicate guard. It is based on the variant of the long position example above (a spot trade example instead), but these additional parameters can be included in any message:

```json
{
    "stub": "dev",
    "direction": "long",
    "symbol": "ETH/USD",
    "size": "50",
    "chart": "T3WBq7Nf",
    "TCycles": "1",
    "TBuys": "2"
}
```

Note: The three parameters could be reduced down to just `uniqueId` with some minor code changes. However, the more precise parameters are included to allow for deletion of orders cached from older cycles.